{"version":3,"sources":["../src/view.js"],"names":["define","$","Str","Repository","PagedContentFactory","PubSub","CustomEvents","Notification","Templates","CourseEvents","Selectors","PagedContentEvents","ModalFactory","ModalEvents","SELECTORS","COURSE_REGION","ACTION_HIDE_COURSE","ACTION_SHOW_COURSE","ACTION_ADD_FAVOURITE","ACTION_REMOVE_FAVOURITE","FAVOURITE_ICON","ICON_IS_FAVOURITE","ICON_NOT_FAVOURITE","PAGED_CONTENT_CONTAINER","ACTION_MAKE_VISIBLE","ACTION_MAKE_INVISIBLE","ACTION_UNENROLME","TEMPLATES","COURSES_CARDS","COURSES_LIST","COURSES_SUMMARY","NOCOURSES","GROUPINGS","GROUPING_ALLINCLUDINGHIDDEN","GROUPING_ALL","GROUPING_INPROGRESS","GROUPING_FUTURE","GROUPING_PAST","GROUPING_FAVOURITES","GROUPING_HIDDEN","NUMCOURSES_PERPAGE","loadedPages","courseOffset","lastPage","lastLimit","namespace","confirmAction","root","courseId","method","args","strings","push","key","component","modalPromise","create","type","types","SAVE_CANCEL","then","deleteModal","show","fail","exception","stringsPromise","get_strings","finalPromise","when","setTitle","setBody","setSaveButtonText","getRoot","on","save","makeVisible","makeInvisible","unenrolMe","instanceId","hideElement","target","getFilterValues","courseRegion","find","courseView","region","display","attr","grouping","sort","displaycategories","customfieldname","customfieldvalue","DEFAULT_PAGED_CONTENT_CONFIG","ignoreControlWhileLoading","controlPlacementBottom","persistentLimitKey","getMyCourses","filters","limit","getEnrolledCoursesByTimeline","offset","classification","getFavouriteIconContainer","getPagedContentContainer","index","getCourseId","hideFavouriteIcon","iconContainer","isFavouriteIcon","addClass","notFavourteIcon","removeClass","showFavouriteIcon","getAddFavouriteMenuItem","getRemoveFavouriteMenuItem","addToFavourites","removeAction","addAction","setCourseFavouriteState","success","publish","favourited","alert","catch","removeFromFavourites","unfavorited","getMakeVisibleMenuItem","getMakeInvisibleMenuItem","getCourseNameItem","getCourseListElement","getCourseHiddenWarningItem","makeVisibleAction","makeInvisibleAction","courseName","courseHiddenWarning","setCourseVisibility","visible","changeCourseVisibility","result","warnings","length","forEach","courseList","courses","course","id","courseListElement","remove","getHideCourseMenuItem","getShowCourseMenuItem","hideCourse","hideAction","showAction","setCourseHiddenState","showCourse","status","updateUserPreferences","preferences","value","pagingBar","jumpto","parseInt","reducedCourse","reduce","accumulator","current","newElement","slice","popElement","merge","pagedContentContainer","resetLastPageNumber","pagedContentPage","renderCourses","html","js","replaceNodeContents","page","setFavouriteCourses","isfavourite","coursesData","currentTemplate","map","showcoursecategory","render","nocoursesimg","setLimit","registerPagedEventHandlers","event","SET_ITEMS_PER_PAGE_LIMIT","subscribe","bind","initializePagedContent","Math","random","pagingLimit","itemsPerPage","active","totalCourseCount","filter","pagingOption","config","extend","eventNamespace","pagedContentPromise","createWithLimit","pagesData","actions","promises","pageData","currentPage","pageNumber","allItemsLoaded","pagePromise","nextPageStart","pageCourses","currentPageLength","remainingCourses","nextoffset","registerEventListeners","events","activate","e","data","favourite","closest","originalEvent","preventDefault","elt","init","reset"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Manage the courses view for the overview block.\n * Additions to the core block_myoverview view.js file.\n *\n * @package    block_myoverview\n * @copyright  2019 Jean-Roch Meurisse - Cellule TICE - Unversite de Namur\n * @copyright  2018 Bas Brands <bas@moodle.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefine(\n[\n    'jquery',\n    'core/str',\n    'theme_receptic/repository',\n    'core/paged_content_factory',\n    'core/pubsub',\n    'core/custom_interaction_events',\n    'core/notification',\n    'core/templates',\n    'core_course/events',\n    'block_myoverview/selectors',\n    'core/paged_content_events',\n    'core/modal_factory',\n    'core/modal_events'\n],\nfunction(\n    $,\n    Str,\n    Repository,\n    PagedContentFactory,\n    PubSub,\n    CustomEvents,\n    Notification,\n    Templates,\n    CourseEvents,\n    Selectors,\n    PagedContentEvents,\n    ModalFactory,\n    ModalEvents\n) {\n\n    var SELECTORS = {\n        COURSE_REGION: '[data-region=\"course-view-content\"]',\n        ACTION_HIDE_COURSE: '[data-action=\"hide-course\"]',\n        ACTION_SHOW_COURSE: '[data-action=\"show-course\"]',\n        ACTION_ADD_FAVOURITE: '[data-action=\"add-favourite\"]',\n        ACTION_REMOVE_FAVOURITE: '[data-action=\"remove-favourite\"]',\n        FAVOURITE_ICON: '[data-region=\"favourite-icon\"]',\n        ICON_IS_FAVOURITE: '[data-region=\"is-favourite\"]',\n        ICON_NOT_FAVOURITE: '[data-region=\"not-favourite\"]',\n        PAGED_CONTENT_CONTAINER: '[data-region=\"page-container\"]',\n        ACTION_MAKE_VISIBLE: '[data-action=\"makevisible-course\"]',\n        ACTION_MAKE_INVISIBLE: '[data-action=\"makeinvisible-course\"]',\n        ACTION_UNENROLME: '[data-action=\"unenrolme\"]',\n    };\n\n    var TEMPLATES = {\n        COURSES_CARDS: 'block_myoverview/view-cards',\n        COURSES_LIST: 'block_myoverview/view-list',\n        COURSES_SUMMARY: 'block_myoverview/view-summary',\n        NOCOURSES: 'core_course/no-courses'\n    };\n\n    var GROUPINGS = {\n        GROUPING_ALLINCLUDINGHIDDEN: 'allincludinghidden',\n        GROUPING_ALL: 'all',\n        GROUPING_INPROGRESS: 'inprogress',\n        GROUPING_FUTURE: 'future',\n        GROUPING_PAST: 'past',\n        GROUPING_FAVOURITES: 'favourites',\n        GROUPING_HIDDEN: 'hidden'\n    };\n\n    var NUMCOURSES_PERPAGE = [12, 24, 48, 96, 0];\n\n    var loadedPages = [];\n\n    var courseOffset = 0;\n\n    var lastPage = 0;\n\n    var lastLimit = 0;\n\n    var namespace = null;\n\n    /**\n     * Confirm action modal window for myoverview block actions.\n     *\n     * @param {object} root The root element.\n     * @param {Number} courseId The course for which an action must be confirmed.\n     * @param {string} method The action to be confirmed.\n     * @param {object} args Misc function parameters.\n     * @return {Promise} The modal result.\n     */\n    function confirmAction(root, courseId, method, args) {\n\n        var strings = [];\n\n        switch(method) {\n            case 'makeVisible' :\n                strings.push({\n                    key: 'makevisible',\n                    component: 'theme_receptic'\n                });\n                strings.push({\n                    key: 'confirmmakevisible',\n                    component: 'theme_receptic'\n                });\n                break;\n            case 'makeInvisible' :\n                strings.push({\n                    key: 'makeinvisible',\n                    component: 'theme_receptic'\n                });\n                strings.push({\n                    key: 'confirmmakeinvisible',\n                    component: 'theme_receptic'\n                });\n                break;\n            case 'unenrolMe' :\n                strings.push({\n                    key: 'unenrolme',\n                    component: 'theme_receptic'\n                });\n                strings.push({\n                    key: 'confirmunenrolme',\n                    component: 'theme_receptic'\n                });\n                break;\n        }\n\n        var modalPromise;\n        modalPromise = ModalFactory.create({\n            type: ModalFactory.types.SAVE_CANCEL\n        });\n\n        modalPromise.then(function(deleteModal) {\n            deleteModal.show();\n\n            return;\n        })\n        .fail(Notification.exception);\n\n        var stringsPromise = Str.get_strings(strings);\n\n        var finalPromise = $.when(stringsPromise, modalPromise)\n            .then(function(strings, deleteModal) {\n                deleteModal.setTitle(strings[0]);\n                deleteModal.setBody(strings[1]);\n\n                deleteModal.setSaveButtonText(strings[0]);\n\n                deleteModal.getRoot().on(ModalEvents.save, function() {\n                    switch(method) {\n                        case 'makeVisible' :\n                            makeVisible(root, courseId);\n                            break;\n                        case 'makeInvisible' :\n                            makeInvisible(root, courseId);\n                            break;\n                        case 'unenrolMe' :\n                            unenrolMe(root, courseId, args.instanceId);\n                            hideElement(root, args.target);\n                            break;\n                    }\n                });\n\n                return deleteModal;\n            })\n            .fail(Notification.exception);\n\n        return finalPromise;\n    }\n    /**\n     * Get filter values from DOM.\n     *\n     * @param {object} root The root element for the courses view.\n     * @return {filters} Set filters.\n     */\n    var getFilterValues = function(root) {\n        var courseRegion = root.find(Selectors.courseView.region);\n        return {\n            display: courseRegion.attr('data-display'),\n            grouping: courseRegion.attr('data-grouping'),\n            sort: courseRegion.attr('data-sort'),\n            displaycategories: courseRegion.attr('data-displaycategories'),\n            customfieldname: courseRegion.attr('data-customfieldname'),\n            customfieldvalue: courseRegion.attr('data-customfieldvalue'),\n        };\n    };\n\n    // We want the paged content controls below the paged content area.\n    // and the controls should be ignored while data is loading.\n    var DEFAULT_PAGED_CONTENT_CONFIG = {\n        ignoreControlWhileLoading: true,\n        controlPlacementBottom: true,\n        persistentLimitKey: 'block_myoverview_user_paging_preference'\n    };\n\n    /**\n     * Get enrolled courses from backend.\n     *\n     * @param {object} filters The filters for this view.\n     * @param {int} limit The number of courses to show.\n     * @return {promise} Resolved with an array of courses.\n     */\n    var getMyCourses = function(filters, limit) {\n\n        return Repository.getEnrolledCoursesByTimeline({\n            offset: courseOffset,\n            limit: limit,\n            classification: filters.grouping,\n            sort: filters.sort,\n            customfieldname: filters.customfieldname,\n            customfieldvalue: filters.customfieldvalue\n        });\n    };\n\n    /**\n     * Get the container element for the favourite icon.\n     *\n     * @param  {Object} root The course overview container\n     * @param  {Number} courseId Course id number\n     * @return {Object} The favourite icon container\n     */\n    var getFavouriteIconContainer = function(root, courseId) {\n        return root.find(SELECTORS.FAVOURITE_ICON + '[data-course-id=\"' + courseId + '\"]');\n    };\n\n    /**\n     * Get the paged content container element.\n     *\n     * @param  {Object} root The course overview container\n     * @param  {Number} index Rendered page index.\n     * @return {Object} The rendered paged container.\n     */\n    var getPagedContentContainer = function(root, index) {\n        return root.find('[data-region=\"paged-content-page\"][data-page=\"' + index + '\"]');\n    };\n\n    /**\n     * Get the course id from a favourite element.\n     *\n     * @param {Object} root The favourite icon container element.\n     * @return {Number} Course id.\n     */\n    var getCourseId = function(root) {\n        return root.attr('data-course-id');\n    };\n\n    /**\n     * Hide the favourite icon.\n     *\n     * @param {Object} root The favourite icon container element.\n     * @param  {Number} courseId Course id number.\n     */\n    var hideFavouriteIcon = function(root, courseId) {\n        var iconContainer = getFavouriteIconContainer(root, courseId);\n        var isFavouriteIcon = iconContainer.find(SELECTORS.ICON_IS_FAVOURITE);\n        isFavouriteIcon.addClass('hidden');\n        isFavouriteIcon.attr('aria-hidden', true);\n        var notFavourteIcon = iconContainer.find(SELECTORS.ICON_NOT_FAVOURITE);\n        notFavourteIcon.removeClass('hidden');\n        notFavourteIcon.attr('aria-hidden', false);\n    };\n\n    /**\n     * Show the favourite icon.\n     *\n     * @param  {Object} root The course overview container.\n     * @param  {Number} courseId Course id number.\n     */\n    var showFavouriteIcon = function(root, courseId) {\n        var iconContainer = getFavouriteIconContainer(root, courseId);\n        var isFavouriteIcon = iconContainer.find(SELECTORS.ICON_IS_FAVOURITE);\n        isFavouriteIcon.removeClass('hidden');\n        isFavouriteIcon.attr('aria-hidden', false);\n        var notFavourteIcon = iconContainer.find(SELECTORS.ICON_NOT_FAVOURITE);\n        notFavourteIcon.addClass('hidden');\n        notFavourteIcon.attr('aria-hidden', true);\n    };\n\n    /**\n     * Get the action menu item\n     *\n     * @param {Object} root  root The course overview container\n     * @param {Number} courseId Course id.\n     * @return {Object} The add to favourite menu item.\n     */\n    var getAddFavouriteMenuItem = function(root, courseId) {\n        return root.find('[data-action=\"add-favourite\"][data-course-id=\"' + courseId + '\"]');\n    };\n\n    /**\n     * Get the action menu item\n     *\n     * @param {Object} root  root The course overview container\n     * @param {Number} courseId Course id.\n     * @return {Object} The remove from favourites menu item.\n     */\n    var getRemoveFavouriteMenuItem = function(root, courseId) {\n        return root.find('[data-action=\"remove-favourite\"][data-course-id=\"' + courseId + '\"]');\n    };\n\n    /**\n     * Add course to favourites\n     *\n     * @param  {Object} root The course overview container\n     * @param  {Number} courseId Course id number\n     */\n    var addToFavourites = function(root, courseId) {\n        var removeAction = getRemoveFavouriteMenuItem(root, courseId);\n        var addAction = getAddFavouriteMenuItem(root, courseId);\n\n        setCourseFavouriteState(courseId, true).then(function(success) {\n            if (success) {\n                PubSub.publish(CourseEvents.favourited, courseId);\n                removeAction.removeClass('hidden');\n                addAction.addClass('hidden');\n                showFavouriteIcon(root, courseId);\n            } else {\n                Notification.alert('Starring course failed', 'Could not change favourite state');\n            }\n            return;\n        }).catch(Notification.exception);\n    };\n\n    /**\n     * Remove course from favourites\n     *\n     * @param  {Object} root The course overview container\n     * @param  {Number} courseId Course id number\n     */\n    var removeFromFavourites = function(root, courseId) {\n        var removeAction = getRemoveFavouriteMenuItem(root, courseId);\n        var addAction = getAddFavouriteMenuItem(root, courseId);\n\n        setCourseFavouriteState(courseId, false).then(function(success) {\n            if (success) {\n                PubSub.publish(CourseEvents.unfavorited, courseId);\n                removeAction.addClass('hidden');\n                addAction.removeClass('hidden');\n                hideFavouriteIcon(root, courseId);\n            } else {\n                Notification.alert('Starring course failed', 'Could not change favourite state');\n            }\n            return;\n        }).catch(Notification.exception);\n    };\n\n    /**\n     * Get the makeVisible action menu item.\n     *\n     * @param  {Object} root The course overview container\n     * @param  {Number} courseId Course id number\n     * @return {Object} The makeVisible menu item.\n     */\n    var getMakeVisibleMenuItem = function(root, courseId) {\n        return root.find('[data-action=\"makevisible-course\"][data-course-id=\"' + courseId + '\"]');\n    };\n\n    /**\n     * Get the makeInvisible action menu item.\n     *\n     * @param  {Object} root The course overview container\n     * @param  {Number} courseId Course id number\n     * @return {Object} The makeInvisible menu item.\n     */\n    var getMakeInvisibleMenuItem = function(root, courseId) {\n        return root.find('[data-action=\"makeinvisible-course\"][data-course-id=\"' + courseId + '\"]');\n    };\n\n    /**\n     * Get the course name node.\n     *\n     * @param  {Object} root The course overview container\n     * @param  {Number} courseId Course id number\n     * @return {Object} The course name node.\n     */\n    var getCourseNameItem = function(root, courseId) {\n        return root.find('[data-region=\"courses-view\"] .coursename[data-course-id=\"' + courseId + '\"]');\n    };\n\n    /**\n     * Get the course element list node.\n     *\n     * @param  {Object} root The course overview container\n     * @param  {Number} courseId Course id number\n     * @return {Object} The course list item.\n     */\n    var getCourseListElement = function(root, courseId) {\n        return root.find('[data-region=\"courses-view\"] .course-listitem[data-course-id=\"' + courseId + '\"]');\n    };\n\n    /**\n     * Get the course hidden warning.\n     *\n     * @param  {Object} root The course overview container\n     * @param  {Number} courseId Course id number\n     * @return {Object} The course hidden warning node.\n     */\n    var getCourseHiddenWarningItem = function(root, courseId) {\n        return root.find('[data-region=\"courses-view\"] .hiddenwarning[data-course-id=\"' + courseId + '\"]');\n    };\n\n    /**\n     * Make course available to students.\n     *\n     * @param  {Object} root The course overview container\n     * @param  {Number} courseId Course id number\n     */\n    var makeVisible = function(root, courseId) {\n        var makeVisibleAction = getMakeVisibleMenuItem(root, courseId);\n        var makeInvisibleAction = getMakeInvisibleMenuItem(root, courseId);\n        var courseName = getCourseNameItem(root, courseId);\n        var courseHiddenWarning = getCourseHiddenWarningItem(root, courseId);\n\n        setCourseVisibility(courseId, true).then(function(success) {\n            if (success) {\n                makeVisibleAction.addClass('hidden');\n                makeInvisibleAction.removeClass('hidden');\n                courseName.removeClass('text-muted');\n                courseHiddenWarning.removeClass('d-flex').addClass('d-none');\n            } else {\n                Notification.alert('Starring course failed', 'Could not change favourite state');\n            }\n            return;\n        }).catch(Notification.exception);\n    };\n\n    /**\n     * Make course unavailable to students.\n     *\n     * @param  {Object} root The course overview container\n     * @param  {Number} courseId Course id number\n     */\n    var makeInvisible = function(root, courseId) {\n        var makeVisibleAction = getMakeVisibleMenuItem(root, courseId);\n        var makeInvisibleAction = getMakeInvisibleMenuItem(root, courseId);\n        var courseName = getCourseNameItem(root, courseId);\n        var courseHiddenWarning = getCourseHiddenWarningItem(root, courseId);\n\n        setCourseVisibility(courseId, false).then(function(success) {\n            if (success) {\n                makeVisibleAction.removeClass('hidden');\n                makeInvisibleAction.addClass('hidden');\n                courseName.addClass('text-muted');\n                courseHiddenWarning.removeClass('d-none').addClass('d-flex');\n            } else {\n                Notification.alert('Starring course failed', 'Could not change favourite state');\n            }\n            return;\n        }).catch(Notification.exception);\n    };\n\n    /**\n     * Set the courses visibility status and push to repository.\n     *\n     * @param  {Number} courseId Course id to favourite.\n     * @param  {Bool} status new favourite status.\n     * @return {Promise} Repository promise.\n     */\n    var setCourseVisibility = function(courseId, visible) {\n\n        return Repository.changeCourseVisibility({\n\n            'id': courseId,\n            'visible': visible\n\n        }).then(function(result) {\n            if (result.warnings.length == 0) {\n                loadedPages.forEach(function(courseList) {\n                    courseList.courses.forEach(function(course, index) {\n                        if (course.id == courseId) {\n                            courseList.courses[index].visible = visible;\n                        }\n                    });\n                });\n                return true;\n            } else {\n                return false;\n            }\n        }).catch(Notification.exception);\n    };\n\n    /**\n     * Unenrol current student from course.\n     *\n     * @param  {Object} root The course overview container\n     * @param  {Number} courseId Course id number\n     * @param  {Number} instanceId The enrolment instance id\n     * @return {Bool} Unenrolment done or not.\n     */\n    var unenrolMe = function(root, courseId, instanceId) {\n        return Repository.unenrolMe({\n\n            'id': courseId,\n            'instanceid': instanceId\n\n        }).then(function(result) {\n            if (result.warnings.length == 0) {\n                var courseListElement = getCourseListElement(root, courseId);\n                $(courseListElement).remove();\n                return true;\n            } else {\n                return false;\n            }\n        }).catch(Notification.exception);\n    };\n\n    /**\n     * Get the action menu item\n     *\n     * @param {Object} root  root The course overview container\n     * @param {Number} courseId Course id.\n     * @return {Object} The hide course menu item.\n     */\n    var getHideCourseMenuItem = function(root, courseId) {\n        return root.find('[data-action=\"hide-course\"][data-course-id=\"' + courseId + '\"]');\n    };\n\n    /**\n     * Get the action menu item\n     *\n     * @param {Object} root  root The course overview container\n     * @param {Number} courseId Course id.\n     * @return {Object} The show course menu item.\n     */\n    var getShowCourseMenuItem = function(root, courseId) {\n        return root.find('[data-action=\"show-course\"][data-course-id=\"' + courseId + '\"]');\n    };\n\n    /**\n     * Hide course\n     *\n     * @param  {Object} root The course overview container\n     * @param  {Number} courseId Course id number\n     */\n    var hideCourse = function(root, courseId) {\n        var hideAction = getHideCourseMenuItem(root, courseId);\n        var showAction = getShowCourseMenuItem(root, courseId);\n        var filters = getFilterValues(root);\n\n        setCourseHiddenState(courseId, true);\n\n        // Remove the course from this view as it is now hidden and thus not covered by this view anymore.\n        // Do only if we are not in \"All\" view mode where really all courses are shown.\n        if (filters.grouping != GROUPINGS.GROUPING_ALLINCLUDINGHIDDEN) {\n            hideElement(root, courseId);\n        }\n\n        hideAction.addClass('hidden');\n        showAction.removeClass('hidden');\n    };\n\n    /**\n     * Show course\n     *\n     * @param  {Object} root The course overview container\n     * @param  {Number} courseId Course id number\n     */\n    var showCourse = function(root, courseId) {\n        var hideAction = getHideCourseMenuItem(root, courseId);\n        var showAction = getShowCourseMenuItem(root, courseId);\n        var filters = getFilterValues(root);\n\n        setCourseHiddenState(courseId, null);\n\n        // Remove the course from this view as it is now shown again and thus not covered by this view anymore.\n        // Do only if we are not in \"All\" view mode where really all courses are shown.\n        if (filters.grouping != GROUPINGS.GROUPING_ALLINCLUDINGHIDDEN) {\n            hideElement(root, courseId);\n        }\n\n        hideAction.removeClass('hidden');\n        showAction.addClass('hidden');\n    };\n\n    /**\n     * Set the courses hidden status and push to repository\n     *\n     * @param  {Number} courseId Course id to favourite.\n     * @param  {Bool} status new hidden status.\n     * @return {Promise} Repository promise.\n     */\n    var setCourseHiddenState = function(courseId, status) {\n\n        // If the given status is not hidden, the preference has to be deleted with a null value.\n        if (status === false) {\n            status = null;\n        }\n        return Repository.updateUserPreferences({\n            preferences: [\n                {\n                    type: 'block_myoverview_hidden_course_' + courseId,\n                    value: status\n                }\n            ]\n        });\n    };\n\n    /**\n     * Reset the loadedPages dataset to take into account the hidden element\n     *\n     * @param {Object} root The course overview container\n     * @param {Number} id The course id number\n     */\n    var hideElement = function(root, id) {\n        var pagingBar = root.find('[data-region=\"paging-bar\"]');\n        var jumpto = parseInt(pagingBar.attr('data-active-page-number'));\n\n        // Get a reduced dataset for the current page.\n        var courseList = loadedPages[jumpto];\n        var reducedCourse = courseList.courses.reduce(function(accumulator, current) {\n            if (id != current.id) {\n                accumulator.push(current);\n            }\n            return accumulator;\n        }, []);\n\n        // Get the next page's data if loaded and pop the first element from it.\n        if (loadedPages[jumpto + 1] != undefined) {\n            var newElement = loadedPages[jumpto + 1].courses.slice(0, 1);\n\n            // Adjust the dataset for the reset of the pages that are loaded.\n            loadedPages.forEach(function(courseList, index) {\n                if (index > jumpto) {\n                    var popElement = [];\n                    if (loadedPages[index + 1] != undefined) {\n                        popElement = loadedPages[index + 1].courses.slice(0, 1);\n                    }\n\n                    loadedPages[index].courses = $.merge(loadedPages[index].courses.slice(1), popElement);\n                }\n            });\n\n\n            reducedCourse = $.merge(reducedCourse, newElement);\n        }\n\n        // Check if the next page is the last page and if it still has data associated to it.\n        if (lastPage == jumpto + 1 && loadedPages[jumpto + 1].courses.length == 0) {\n            var pagedContentContainer = root.find('[data-region=\"paged-content-container\"]');\n            PagedContentFactory.resetLastPageNumber($(pagedContentContainer).attr('id'), jumpto);\n        }\n\n        loadedPages[jumpto].courses = reducedCourse;\n\n        // Reduce the course offset.\n        courseOffset--;\n\n        // Render the paged content for the current.\n        var pagedContentPage = getPagedContentContainer(root, jumpto);\n        renderCourses(root, loadedPages[jumpto]).then(function(html, js) {\n            return Templates.replaceNodeContents(pagedContentPage, html, js);\n        }).catch(Notification.exception);\n\n        // Delete subsequent pages in order to trigger the callback.\n        loadedPages.forEach(function(courseList, index) {\n            if (index > jumpto) {\n                var page = getPagedContentContainer(root, index);\n                page.remove();\n            }\n        });\n    };\n\n    /**\n     * Set the courses favourite status and push to repository\n     *\n     * @param  {Number} courseId Course id to favourite.\n     * @param  {Bool} status new favourite status.\n     * @return {Promise} Repository promise.\n     */\n    var setCourseFavouriteState = function(courseId, status) {\n\n        return Repository.setFavouriteCourses({\n            courses: [{\n                'id': courseId,\n                'favourite': status\n            }]\n        }).then(function(result) {\n            if (result.warnings.length == 0) {\n                loadedPages.forEach(function(courseList) {\n                    courseList.courses.forEach(function(course, index) {\n                        if (course.id == courseId) {\n                            courseList.courses[index].isfavourite = status;\n                        }\n                    });\n                });\n                return true;\n            } else {\n                return false;\n            }\n        }).catch(Notification.exception);\n    };\n\n    /**\n     * Render the dashboard courses.\n     *\n     * @param {object} root The root element for the courses view.\n     * @param {array} coursesData containing array of returned courses.\n     * @return {promise} jQuery promise resolved after rendering is complete.\n     */\n    var renderCourses = function(root, coursesData) {\n\n        var filters = getFilterValues(root);\n\n        var currentTemplate = '';\n        if (filters.display == 'card') {\n            currentTemplate = TEMPLATES.COURSES_CARDS;\n        } else if (filters.display == 'list') {\n            currentTemplate = TEMPLATES.COURSES_LIST;\n        } else {\n            currentTemplate = TEMPLATES.COURSES_SUMMARY;\n        }\n\n        // Whether the course category should be displayed in the course item.\n        coursesData.courses = coursesData.courses.map(function(course) {\n            course.showcoursecategory = filters.displaycategories == 'on' ? true : false;\n            return course;\n        });\n\n        if (coursesData.courses.length) {\n            return Templates.render(currentTemplate, {\n                courses: coursesData.courses,\n            });\n        } else {\n            var nocoursesimg = root.find(Selectors.courseView.region).attr('data-nocoursesimg');\n            return Templates.render(TEMPLATES.NOCOURSES, {\n                nocoursesimg: nocoursesimg\n            });\n        }\n    };\n\n    /**\n     * Return the callback to be passed to the subscribe event\n     *\n     * @param {Number} limit The paged limit that is passed through the event\n     */\n    var setLimit = function(limit) {\n        this.find(Selectors.courseView.region).attr('data-paging', limit);\n    };\n\n    /**\n     * Intialise the paged list and cards views on page load.\n     * Returns an array of paged contents that we would like to handle here\n     *\n     * @param {object} root The root element for the courses view\n     * @param {string} namespace The namespace for all the events attached\n     */\n    var registerPagedEventHandlers = function(root, namespace) {\n        var event = namespace + PagedContentEvents.SET_ITEMS_PER_PAGE_LIMIT;\n        PubSub.subscribe(event, setLimit.bind(root));\n    };\n\n    /**\n     * Intialise the courses list and cards views on page load.\n     *\n     * @param {object} root The root element for the courses view.\n     * @param {object} content The content element for the courses view.\n     */\n    var initializePagedContent = function(root) {\n        namespace = \"block_myoverview_\" + root.attr('id') + \"_\" + Math.random();\n\n        var pagingLimit = parseInt(root.find(Selectors.courseView.region).attr('data-paging'), 10);\n        var itemsPerPage = NUMCOURSES_PERPAGE.map(function(value) {\n            var active = false;\n            if (value == pagingLimit) {\n                active = true;\n            }\n\n            return {\n                value: value,\n                active: active\n            };\n        });\n\n        // Filter out all pagination options which are too large for the amount of courses user is enrolled in.\n        var totalCourseCount = parseInt(root.find(Selectors.courseView.region).attr('data-totalcoursecount'), 10);\n        itemsPerPage = itemsPerPage.filter(function(pagingOption) {\n            return pagingOption.value < totalCourseCount || pagingOption.value === 0;\n        });\n\n        var filters = getFilterValues(root);\n        var config = $.extend({}, DEFAULT_PAGED_CONTENT_CONFIG);\n        config.eventNamespace = namespace;\n\n        var pagedContentPromise = PagedContentFactory.createWithLimit(\n            itemsPerPage,\n            function(pagesData, actions) {\n                var promises = [];\n\n                pagesData.forEach(function(pageData) {\n                    var currentPage = pageData.pageNumber;\n                    var limit = (pageData.limit > 0) ? pageData.limit : 0;\n\n                    // Reset local variables if limits have changed.\n                    if (lastLimit != limit) {\n                        loadedPages = [];\n                        courseOffset = 0;\n                        lastPage = 0;\n                    }\n\n                    if (lastPage == currentPage) {\n                        // If we are on the last page and have it's data then load it from cache.\n                        actions.allItemsLoaded(lastPage);\n                        promises.push(renderCourses(root, loadedPages[currentPage]));\n                        return;\n                    }\n\n                    lastLimit = limit;\n\n                    // Get 2 pages worth of data as we will need it for the hidden functionality.\n                    if (loadedPages[currentPage + 1] == undefined) {\n                        if (loadedPages[currentPage] == undefined) {\n                            limit *= 2;\n                        }\n                    }\n\n                    var pagePromise = getMyCourses(\n                        filters,\n                        limit\n                    ).then(function(coursesData) {\n                        var courses = coursesData.courses;\n                        var nextPageStart = 0;\n                        var pageCourses = [];\n\n                        // If current page's data is loaded make sure we max it to page limit.\n                        if (loadedPages[currentPage] != undefined) {\n                            pageCourses = loadedPages[currentPage].courses;\n                            var currentPageLength = pageCourses.length;\n                            if (currentPageLength < pageData.limit) {\n                                nextPageStart = pageData.limit - currentPageLength;\n                                pageCourses = $.merge(loadedPages[currentPage].courses, courses.slice(0, nextPageStart));\n                            }\n                        } else {\n                            // When the page limit is zero, there is only one page of courses, no start for next page.\n                            nextPageStart = pageData.limit || false;\n                            pageCourses = (pageData.limit > 0) ? courses.slice(0, pageData.limit) : courses;\n                        }\n\n                        // Finished setting up the current page\n                        loadedPages[currentPage] = {\n                            courses: pageCourses\n                        };\n\n                        // Set up the next page (if there is more than one page).\n                        var remainingCourses = nextPageStart !== false ? courses.slice(nextPageStart, courses.length) : [];\n                        if (remainingCourses.length) {\n                            loadedPages[currentPage + 1] = {\n                                courses: remainingCourses\n                            };\n                        }\n\n                        // Set the last page to either the current or next page.\n                        if (loadedPages[currentPage].courses.length < pageData.limit || !remainingCourses.length) {\n                            lastPage = currentPage;\n                            actions.allItemsLoaded(currentPage);\n                        } else if (loadedPages[currentPage + 1] != undefined\n                            && loadedPages[currentPage + 1].courses.length < pageData.limit) {\n                            lastPage = currentPage + 1;\n                        }\n\n                        courseOffset = coursesData.nextoffset;\n                        return renderCourses(root, loadedPages[currentPage]);\n                    })\n                    .catch(Notification.exception);\n\n                    promises.push(pagePromise);\n                });\n\n                return promises;\n            },\n            config\n        );\n\n        pagedContentPromise.then(function(html, js) {\n            registerPagedEventHandlers(root, namespace);\n            return Templates.replaceNodeContents(root.find(Selectors.courseView.region), html, js);\n        }).catch(Notification.exception);\n    };\n\n    /**\n     * Listen to, and handle events for  the myoverview block.\n     *\n     * @param {Object} root The myoverview block container element.\n     */\n    var registerEventListeners = function(root) {\n        CustomEvents.define(root, [\n            CustomEvents.events.activate\n        ]);\n\n        root.on(CustomEvents.events.activate, SELECTORS.ACTION_ADD_FAVOURITE, function(e, data) {\n            var favourite = $(e.target).closest(SELECTORS.ACTION_ADD_FAVOURITE);\n            var courseId = getCourseId(favourite);\n            addToFavourites(root, courseId);\n            data.originalEvent.preventDefault();\n        });\n\n        root.on(CustomEvents.events.activate, SELECTORS.ACTION_REMOVE_FAVOURITE, function(e, data) {\n            var favourite = $(e.target).closest(SELECTORS.ACTION_REMOVE_FAVOURITE);\n            var courseId = getCourseId(favourite);\n            removeFromFavourites(root, courseId);\n            data.originalEvent.preventDefault();\n        });\n\n        root.on(CustomEvents.events.activate, SELECTORS.ACTION_MAKE_VISIBLE, function(e, data) {\n            var elt = $(e.target).closest(SELECTORS.ACTION_MAKE_VISIBLE);\n            var courseId = getCourseId(elt);\n            confirmAction(root, courseId, 'makeVisible', '');\n            data.originalEvent.preventDefault();\n        });\n\n        root.on(CustomEvents.events.activate, SELECTORS.ACTION_MAKE_INVISIBLE, function(e, data) {\n            var elt = $(e.target).closest(SELECTORS.ACTION_MAKE_INVISIBLE);\n            var courseId = getCourseId(elt);\n            confirmAction(root, courseId, 'makeInvisible', '');\n            data.originalEvent.preventDefault();\n        });\n\n        root.on(CustomEvents.events.activate, SELECTORS.ACTION_UNENROLME, function(e, data) {\n            var target = $(e.target).closest(SELECTORS.ACTION_UNENROLME);\n            var courseId = getCourseId(target);\n            var instanceId = $(e.target).attr('data-enrol-id');\n            var extraargs = {\n                'instanceId': instanceId,\n                'target': target\n            };\n            confirmAction(root, courseId, 'unenrolMe', extraargs);\n            data.originalEvent.preventDefault();\n        });\n\n        root.on(CustomEvents.events.activate, SELECTORS.FAVOURITE_ICON, function(e, data) {\n            data.originalEvent.preventDefault();\n        });\n\n        root.on(CustomEvents.events.activate, SELECTORS.ACTION_HIDE_COURSE, function(e, data) {\n            var target = $(e.target).closest(SELECTORS.ACTION_HIDE_COURSE);\n            var courseId = getCourseId(target);\n            hideCourse(root, courseId);\n            data.originalEvent.preventDefault();\n        });\n\n        root.on(CustomEvents.events.activate, SELECTORS.ACTION_SHOW_COURSE, function(e, data) {\n            var target = $(e.target).closest(SELECTORS.ACTION_SHOW_COURSE);\n            var courseId = getCourseId(target);\n            showCourse(root, courseId);\n            data.originalEvent.preventDefault();\n        });\n    };\n\n    /**\n     * Intialise the courses list and cards views on page load.\n     *\n     * @param {object} root The root element for the courses view.\n     */\n    var init = function(root) {\n        root = $(root);\n        loadedPages = [];\n        lastPage = 0;\n        courseOffset = 0;\n\n        initializePagedContent(root);\n\n        if (!root.attr('data-init')) {\n            registerEventListeners(root);\n            root.attr('data-init', true);\n        }\n    };\n\n    /**\n\n     * Reset the courses views to their original\n     * state on first page load.courseOffset\n     *\n     * This is called when configuration has changed for the event lists\n     * to cause them to reload their data.\n     *\n     * @param {Object} root The root element for the timeline view.\n     */\n    var reset = function(root) {\n        if (loadedPages.length > 0) {\n            loadedPages.forEach(function(courseList, index) {\n                var pagedContentPage = getPagedContentContainer(root, index);\n                renderCourses(root, courseList).then(function(html, js) {\n                    return Templates.replaceNodeContents(pagedContentPage, html, js);\n                }).catch(Notification.exception);\n            });\n        } else {\n            init(root);\n        }\n    };\n\n    return {\n        init: init,\n        reset: reset\n    };\n});\n"],"file":"view.min.js"}